<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>M'GEMS Interview Buddy</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <a href="#main-content" class="skip-link">Skip to content</a>

    <div id="loading-overlay">
        <div class="loader">Loading...</div>
    </div>

    <div class="top-bar">
        <div class="app-header">
            <h1>M'GEMS Interview Buddy</h1>
            <p class="tagline">Your Smart Interview Buddy</p>
        </div>
        <div class="controls">
            <button id="create-meeting-btn">Create Meeting</button>
            <button id="knowledge-base-btn">Knowledge Base</button>
            <button id="api-config-btn">API Config</button>
            <button id="debug-settings-btn">Debug</button>
            <button id="theme-toggle">Theme</button>
            <button id="pip-icon-btn" class="pip-icon-btn" title="Toggle PIP Mode">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H5v-4h4v4zm0-6H5V7h4v4zm6 6h-4v-4h4v4zm0-6h-4V7h4v4zm6 6h-4v-4h4v4zm0-6h-4V7h4v4z"/>
                </svg>
            </button>
        </div>
    </div>

    <div id="notification-container"></div>

    <main id="main-content">
        <div id="meeting-status">Ready</div>

        <section id="screen-share-main">
            <h2>Screen Share</h2>
            <div id="screen-thumbnails"></div>
            <button id="share-screen-btn">Share Screen</button>
            <button id="stop-share-btn" disabled>Stop Sharing</button>
        </section>

        <section id="interviewer-transcription">
            <h2>Transcription</h2>
            <div id="transcription-status"></div>
            <div class="controls">
                <button id="start-transcription-btn">Start</button>
                <button id="stop-transcription-btn" disabled>Stop</button>
                <button id="clear-transcription-btn">Clear</button>
            </div>
        </section>

        <section id="questions-area">
            <h2>Questions</h2>
            <div id="questions-list"></div>
            <button id="generate-questions-btn">Generate Questions</button>
        </section>
    </main>

</div>

    <div id="knowledge-base-panel" class="hidden">
        <div class="panel-content">
            <h2>Knowledge Base Template Editor</h2>
            <div class="template-info">
                <p>Customize the template used for generating interview questions. This template will be used when you click "Generate Questions".</p>
            </div>
            <form id="knowledge-base-form">
                <!-- Template Management Section -->
                <div class="template-management">
                    <h3>üìù Template Management</h3>
                    <div class="form-group">
                        <label for="template-name">Template Name</label>
                        <input type="text" id="template-name" placeholder="Enter template name (e.g., Google Ads Expert, Meta Ads Specialist)">
                    </div>
                    
                    <div class="form-group">
                        <label for="template-selector">Load Existing Template</label>
                        <select id="template-selector">
                            <option value="">-- Select Template --</option>
                        </select>
                        <div style="display: flex; gap: 0.5rem; margin-top: 0.5rem;">
                            <button type="button" id="save-builtin-template-btn" class="save-btn" style="display: none;">Save Built-in Template</button>
                            <button type="button" id="delete-template-btn" class="danger-btn">Delete Selected</button>
                        </div>
                    </div>
                </div>

                <!-- Portfolio Information Section -->
                <div class="portfolio-section">
                  <h3>üë§ Portfolio Information</h3>
                  <div class="form-group">
                    <label for="portfolio-niche">Niche / Role Type</label>
                    <select id="portfolio-niche">
                      <option value="digital-marketing">Digital Marketing / Ads Expert</option>
                      <option value="customer-service">Customer Service Representative</option>
                      <option value="technical-support">Technical Support Specialist</option>
                      <option value="virtual-assistant">Virtual Assistant</option>
                      <option value="other">Other (Custom)</option>
                    </select>
                  </div>
                  <div class="form-group">
                    <label for="portfolio-name">Applicant Name</label>
                        <input type="text" id="portfolio-name" placeholder="Enter applicant's full name">
                    </div>
                
                <div class="form-group">
                    <label for="portfolio-title">Professional Title</label>
                    <input type="text" id="portfolio-title" placeholder="e.g., Google Ads Specialist, Digital Marketing Manager">
                </div>
                
                <div class="form-group">
                    <label for="portfolio-experience">Years of Experience</label>
                    <input type="number" id="portfolio-experience" min="0" max="50" placeholder="Years of experience">
                </div>
                
                <div class="form-group">
                    <label for="portfolio-budget">Budget Managed</label>
                    <input type="text" id="portfolio-budget" placeholder="e.g., $10,000/month, $500K annually">
                </div>
                
                <div class="form-group">
                    <label for="portfolio-specialization">Specialization</label>
                    <input type="text" id="portfolio-specialization" placeholder="e.g., Local lead generation, E-commerce, Service-based businesses">
                </div>
                
                <div class="form-group">
                    <label for="portfolio-certifications">Certifications</label>
                    <textarea id="portfolio-certifications" rows="3" placeholder="List relevant certifications (one per line)"></textarea>
                </div>
                
                <div class="form-group">
                    <label for="portfolio-achievements">Key Achievements</label>
                    <textarea id="portfolio-achievements" rows="4" placeholder="List key achievements and metrics (one per line)"></textarea>
                </div>
                
                <div class="form-group">
                    <label for="portfolio-skills">Core Skills</label>
                    <textarea id="portfolio-skills" rows="3" placeholder="List core competencies (one per line)"></textarea>
                </div>
                </div>

                <!-- Template Content Section -->
                <div class="form-group">
                    <label for="template-content">Template Content</label>
                    <textarea id="template-content" rows="10" placeholder="Enter your template here..."></textarea>
                    <div class="template-hints">
                        <p><strong>Template Variables:</strong></p>
                        <ul>
                            <li><code>{context}</code> - Current transcription context</li>
                            <li><code>{topic}</code> - Interview topic (Google Ads)</li>
                            <li><code>{num_questions}</code> - Number of questions to generate</li>
                            <li><code>{name}</code> - Applicant's name</li>
                            <li><code>{title}</code> - Professional title</li>
                            <li><code>{experience}</code> - Years of experience</li>
                            <li><code>{budget}</code> - Budget managed</li>
                            <li><code>{specialization}</code> - Specialization area</li>
                            <li><code>{certifications}</code> - List of certifications</li>
                            <li><code>{achievements}</code> - Key achievements</li>
                            <li><code>{skills}</code> - Core skills</li>
                        </ul>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="default-topic">Default Topic</label>
                    <input type="text" id="default-topic" value="Google Ads" placeholder="Enter default topic">
                </div>
                <div class="form-group">
                    <label for="num-questions">Number of Questions</label>
                    <input type="number" id="num-questions" value="5" min="1" max="10">
                </div>
                <div class="form-actions">
                    <button type="button" id="auto-generate-template-btn">Auto-Generate from Portfolio</button>
                    <button type="button" id="reset-template-btn">Reset to Default</button>
                    <button type="button" id="preview-template-btn">Preview</button>
                    <button type="submit">Save Template</button>
                </div>
            </form>
            <div id="template-preview" class="hidden">
                <h3>Template Preview</h3>
                <div id="preview-content"></div>
            </div>
        </div>
    </div>

    <div id="api-config-panel" class="hidden">
        <div class="panel-content">
            <h2>API Configuration</h2>
            <form id="api-config-form">
                <div class="form-group">
                    <label for="deepseek-api-key">DeepSeek API Key</label>
                    <div class="input-wrapper">
                        <input type="password" id="deepseek-api-key" placeholder="DeepSeek API Key">
                        <button type="button" class="toggle-password">Show</button>
                        <button type="button" id="paste-deepseek-key">Paste</button>
                    </div>
                </div>
                <div class="form-group">
                    <label for="deepgram-api-key">Deepgram API Key</label>
                    <div class="input-wrapper">
                        <input type="password" id="deepgram-api-key" placeholder="Deepgram API Key">
                        <button type="button" class="toggle-password">Show</button>
                        <button type="button" id="paste-deepgram-key">Paste</button>
                    </div>
                </div>
                <div class="form-group">
                    <label for="gemini-api-key">Gemini API Key</label>
                    <div class="input-wrapper">
                        <input type="password" id="gemini-api-key" placeholder="Gemini API Key">
                        <button type="button" class="toggle-password">Show</button>
                        <button type="button" id="paste-gemini-key">Paste</button>
                    </div>
                </div>
                <div class="form-group">
                    <label for="gemini-base-url">Gemini Base URL</label>
                    <input type="text" id="gemini-base-url" value="https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent">
                </div>
                <div class="form-group">
                    <label for="deepseek-base-url">DeepSeek Base URL</label>
                    <input type="text" id="deepseek-base-url" value="https://api.deepseek.com/v1">
                </div>
                <div class="form-group">
                    <label for="system-prompt">System Prompt</label>
                    <textarea id="system-prompt"></textarea>
                </div>
                <div class="form-actions">
                    <button type="button" id="test-apis-btn">Test APIs</button>
                    <button type="submit">Save</button>
                </div>
            </form>
        </div>
    </div>

    <div id="pip-overlay" class="hidden">
        <div class="pip-header">
            <button id="pip-toggle-btn">_</button>
            <button id="pip-resize-btn">[]</button>
            <button id="pip-close-btn">X</button>
        </div>
        <div id="pip-content">
            <div class="pip-transcription-container">
                <div class="pip-transcription-text"></div>
            </div>
            <div class="pip-ai-container">
                <div class="pip-ai-header">AI Assistant</div>
                <div class="pip-ai-content"></div>
            </div>
        </div>
        <!-- Resize handles -->
        <div class="resize-handle resize-nw"></div>
        <div class="resize-handle resize-ne"></div>
        <div class="resize-handle resize-sw"></div>
        <div class="resize-handle resize-se"></div>
        <div class="resize-handle resize-n"></div>
        <div class="resize-handle resize-s"></div>
        <div class="resize-handle resize-w"></div>
        <div class="resize-handle resize-e"></div>
        
        <!-- Resize indicator -->
        <div class="resize-indicator"></div>
    </div>

    <!-- Deepgram SDK fallback (primary and only source) -->
    <script src="deepgram-fallback.js"></script>
    <script src="knowledge-base.js"></script>
    
    <!-- Debug: Verify fallback loaded correctly -->
    <script>
        console.log('=== DEEPGRAM FALLBACK DEBUG ===');
        console.log('window.Deepgram type:', typeof window.Deepgram);
        console.log('Deepgram global type:', typeof Deepgram);
        console.log('window.Deepgram available:', !!window.Deepgram);
        
        if (window.Deepgram) {
            console.log('‚úÖ Deepgram fallback successfully loaded!');
            try {
                const testInstance = new window.Deepgram('debug-key-12345678');
                console.log('‚úÖ Deepgram instance created successfully:', testInstance);
                console.log('‚úÖ Deepgram has transcription property:', !!testInstance.transcription);
            } catch (error) {
                console.error('‚ùå Failed to create Deepgram instance:', error);
            }
        } else {
            console.error('‚ùå Deepgram fallback NOT available!');
            console.error('This means script.js will use its own WebSocket implementation.');
        }
        console.log('=== END DEBUG ===');
    </script>
    
    <script src="script.js"></script>
</body>
</html>
